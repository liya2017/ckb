# This is a basic workflow that is manually triggered

name: Repository-dispatch workflow Test

# Controls when the action will run. Workflow runs when manually triggered using the UI
# or API.
on:
  workflow_dispatch:
    # Inputs the workflow accepts.
    inputs:
      name:
        # Friendly description to be shown in the UI instead of 'name'
        description: 'Person to greet'
        # Default value if no value is explicitly provided
        default: 'World'
        # Input has to be provided for the workflow to run
        required: true
      # logLevel:
      #   description: 'Log level'     
      #   required: true
      #   default: 'warning'
env:
  CARGO_TARGET_DIR: "${{ github.workspace }}/../target"
jobs:
  Benchmarks_Test:
    name: Build Modified
    runs-on: [ self-hosted, Linux, X64, package-for-linux ]
    strategy:
      matrix:
        repeat: [1, 2]
    continue-on-error: true
    concurrency:
      group: Benchmarks_Test_${{matrix.repeat}}
      cancel-in-progress: true
    steps:
      - uses: actions/checkout@v2
      - name: Repository Dispatch
        uses: peter-evans/repository-dispatch@v1
        with:
          token: ${{ secrets.WORKFLOW_TOKEN }}
          event-type: do-something
          client-payload: '{"github": ${{ toJson(github) }}}'
      # - name: Wait on Benchmark
        # uses: convictional/trigger-workflow-and-wait@v1.3.0 
        # with:
        #   owner: keithconvictional
        #   repo: myrepo
        #   github_token: ${{ secrets.WORKFLOW_TOKEN }}
        #   workflow_file_name: benchmark.yml
        #   ref: ${{ github.ref }}
        #   wait_interval: 10
        #   inputs: '{}'
        #   propagate_failure: false
        #   trigger_workflow: true
        #   wait_workflow: true

      # - name: Download math result for job 1
      #   uses: actions/download-artifact@v2
      #   with:
      #     path: artifacts
      # - run: |
      #     ls